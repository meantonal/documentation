---
title: Tonality
description: Reference page for functions related to TonalContext, and the position of notes within a key or mode.
sidebar:
  order: 4
---

import { Aside } from '@astrojs/starlight/components';

This page details all the functions that create `TonalContext` objects, query [`Pitch`](/c/pitch) vectors against them, or manipulate `Pitch` vectors diatonically with respect to a governing key or mode.

## Creating a TonalContext

In order to define a `TonalContext`, you need a way to specify the tonic, along with the [`mode`](/c/types/#enum-mode).

### context_from_str

```c
int context_from_str(char *s, enum Mode mode, TonalContext *out);
```

This function allows you to initialise a `TonalContext` from a note name as a string. the created context is returned via an out-param (you must pass in a pointer to a `TonalContext`). Returns 1 if there is a parsing error.

Safe usage if the string is being passed in dynamically:

```c
TonalContext key;
if (int context_from_str(str, &key)) {
    // handle parsing error
}
```

## Common Queries

The essential thing a `TonalContext` allows you to query is the scale degree represented by a `Pitch`, and its alteration with respect to the key signature.

### `degree_number`

```c
int degree_number(Pitch p, TonalContext k);
```

Reconciles a `Pitch` against a `TonalContext` and returns the scale degree it represents there. Result is 0-indexed, so the tonic is 0 rather than 1.

### `degree_alteration`

```c
enum Alteration degree_alteration(Pitch p, TonalContext k);
```

Reconciles a `Pitch` against a `TonalContext` and returns its alteration.

Compare return values against the [`enum Alteration`](/c/types/#enum-alteration).

<Aside type="caution">
Remember to check for both `FOREIGN_DEG_SHARP` and `FOREIGN_DEG_FLAT` returns from this function: a `Pitch` can lie outside the governing key/mode in both directions.
</Aside>
