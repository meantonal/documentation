---
title: Key
description: Reference page for Key-related functions.
sidebar:
  order: 4
---

import { Aside } from '@astrojs/starlight/components';

This page details all the functions that create `Key` objects, and query [`Pitch`](/c/pitch) vectors against them.

## Creating Keys

As structs, a `Key` can obviously be initialised directly:

```c
Key k = { .chroma = 3, .mode = DORIAN }; // initialised to A dorian
```

If you know your key signatures this is potentially all you need: a `Pitch`'s chroma is the same as the number of sharps or flats its key signature would have if it were the tonic of a major key, with sharps as positive and flats as negative integers.

If you have a `Pitch` vector handy, you can also do:

```c
Key k = {
    .chroma = pitch_chroma(p),
    .mode = DORIAN
}
```

### key_from_str

```c
int key_from_str(char *s, enum Mode mode, Key *out);
```

Sometimes it's easier to initialise from a note name as a string. This function parses a `Key` from a string, and outputs the `Key` via an out-param (you must pass in a pointer to a `Key`). Returns 1 if there is a parsing error.

Safe usage if the string is being passed in dynamically:

```c
Key k;
if (int key_from_str(str, &k)) {
    // handle parsing error
}
```

## Common Queries

The essential thing a `Key` allows you to query is the scale degree represented by a `Pitch`, and its alteration with respect to the version of that letter name diatonic to the key / mode.

### `degree_number`

```c
int degree_number(Pitch p, Key k);
```

Reconciles a `Pitch` against a `Key` and returns the scale degree it represents there. Result is 0-indexed, so the tonic is 0 rather than 1.

### `degree_alteration`

```c
enum Alteration degree_alteration(Pitch p, Key k);
```

Reconciles a `Pitch` against a `Key` and returns its alteration.

Compare return values against the [`enum Alteration`](/c/types/#enum-alteration).

<Aside type="caution">
Remember to check for both `FOREIGN_DEG_SHARP` and `FOREIGN_DEG_FLAT` returns from this function: a `Pitch` can lie outside the governing key/mode in both directions.
</Aside>
